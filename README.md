# Respiratory Differencing: Enhancing Pulmonary Thermal Ablation Evaluation Through Pre- and Intra- Operative Image Fusion
CT image-guided thermal ablation is widely used for lung cancer treatment; however, follow-up data indicate that physicians’ subjective assessments of intraoperative images often overestimate the ablation effect, potentially leading to incomplete treatment.
To address these challenges, we developed Respiratory Differencing, a novel intraoperative CT image assistance system aimed at improving ablation evaluation. The system first segments tumor regions in preoperative CT images and then employs a multi-stage registration process to align these images with corresponding intraoperative or postoperative images, compensating for respiratory deformations and treatment-induced changes. This system provides two key outputs to help physicians evaluate intraoperative ablation. First, differential images are generated by subtracting the registered preoperative images from the intraoperative ones, allowing direct visualization and quantitative comparison of pre- and post-treatment differences. These differential images enable physicians to assess the relative positions of the tumor and ablation zones, even when the tumor is no longer visible in post-ablation images, thus improving the subjective evaluation of ablation effectiveness. Second, the system provides a quantitative metric that measures the discrepancies between the tumor area and the treatment zone, offering a numerical assessment of the overall efficacy of ablation.
This pioneering system compensates for complex lung deformations and integrates pre- and intra-operative imaging data, enhancing quality control in cancer ablation treatments. A follow-up study involving 35 clinical cases demonstrated that our system significantly outperforms traditional subjective assessments in identifying under-ablation cases during or immediately after treatment, highlighting its potential to improve clinical decision-making and patient outcomes.


# Dataset
## Dataset introduction
The majority of the CT images used in this study are taken by GE MEDICAL SYSTEMS’s Revolution CT (General Electric Company, USA) with a peak kilo voltage of 120kV. In our experiment, all the involved ground truth masks were manually annotated by doctors. All the CT data underwent preprocessing, which included cropping to the dimension of 256*256*256 and configuring the spacing to 1.25mm*1.25mm*1.25mm. Subsequently, normalization was performed to scale the pixel values of the data within the range between zero and one. The proposed Respiratory Differencing method and the aforementioned evaluation metrics were utilized in the conducted experiments. For all statistical analyses, SPSS software was used to perform Kappa analysis and Spearman correlation analysis.
## Statistical analysis of pre- and postoperative HU around tumor region
The Hounsfield Unit (HU) values around the tumor region were statistically analyzed both preoperative and postoperative. The analyzed region specifically refers to the area outside the tumor area but within the treatment area. The statistical analysis reveals a significant difference in HU values in the region before and after surgery, with the two distributions distinguishable using a threshold of around -600 HU. This statistical finding has significant clinical implications for the evaluation of lung ablation surgeries. It allows for determining the range of ablation by assessing the average HU value at the ablation site. The finding aligns with the clinical follow-up outcomes obtained from 35 patients.
<img src="https://github.com/computerAItest/GraphMorph/blob/main/GraphMorph/data/landmark.png?raw=true" width="900" alt="demo"/><br/>

## 4D-CT Clinical Data Demo
<img src="https://github.com/computerAItest/GraphMorph/blob/main/GraphMorph/data/data_Demo.png?raw=true" width="900" alt="demo"/><br/>

<div style="display: flex; justify-content: space-between;">
    <img src="https://github.com/computerAItest/GraphMorph/blob/main/GraphMorph/data/4d_slice_registered.gif?raw=true" width="300" alt="demo"/>
    <img src="https://github.com/computerAItest/GraphMorph/blob/main/GraphMorph/data/4d_volume_registered.gif?raw=true" width="300" alt="demo"/>
</div>

Post-registration 4D-CT 2D rendering  &nbsp;&nbsp; Post-registration 4D-CT 3D rendering
